name: Add DNS Record v5

on:
  workflow_dispatch:

jobs:
  add-dns:
    runs-on: ubuntu-latest
    steps:
      - name: Install Playwright
        run: |
          npm init -y
          npm install playwright
          npx playwright install chromium

      - name: Add CNAME portal.artvision.pro
        run: |
          cat > add_dns.js << 'EOF'
          const { chromium } = require("playwright");

          (async () => {
            const browser = await chromium.launch({ headless: true });
            const page = await browser.newPage();
            
            try {
              console.log("üîê –õ–æ–≥–∏–Ω...");
              await page.goto("https://hosting.timeweb.ru/login");
              await page.waitForTimeout(3000);
              await page.fill("input[type=\"text\"]", "cp02586");
              await page.fill("input[type=\"password\"]", "6CNgRdxX222");
              await page.click("button[type=\"submit\"]");
              await page.waitForTimeout(5000);
              
              console.log("üåê DNS —Ä–µ–¥–∞–∫—Ç–æ—Ä...");
              await page.goto("https://hosting.timeweb.ru/domains/settings/dns-editor?fqdn=artvision.pro");
              await page.waitForTimeout(4000);
              
              // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø—ã
              const closeButtons = await page.$$("button:has-text(\"–ó–∞–∫—Ä—ã—Ç—å\"), button:has-text(\"–ü–æ–Ω—è—Ç–Ω–æ\")");
              for (const btn of closeButtons) { await btn.click().catch(() => {}); }
              await page.waitForTimeout(500);
              
              console.log("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å...");
              await page.click("text=–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å");
              await page.waitForTimeout(2000);
              
              // –û—Ç–∫—Ä—ã–≤–∞–µ–º dropdown —Ç–∏–ø–∞
              console.log("üìù –û—Ç–∫—Ä—ã–≤–∞—é dropdown...");
              await page.click("[class*=\"select\"] >> text=A");
              await page.waitForTimeout(1000);
              
              // –ö–ª–∏–∫–∞–µ–º –Ω–∞ CNAME –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è —Å–ø–∏—Å–∫–µ (4-–π —ç–ª–µ–º–µ–Ω—Ç)
              console.log("üìù –ö–ª–∏–∫–∞—é –Ω–∞ CNAME –≤ —Å–ø–∏—Å–∫–µ...");
              
              // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º CNAME –≤–Ω—É—Ç—Ä–∏ dropdown
              const cnameOption = await page.$("div[class*=\"option\"]:has-text(\"CNAME\"), li:has-text(\"CNAME\"), [role=\"option\"]:has-text(\"CNAME\")");
              if (cnameOption) {
                await cnameOption.click();
                console.log("‚úÖ –ö–ª–∏–∫–Ω—É–ª –Ω–∞ CNAME option");
              } else {
                // –ü—Ä–æ–±—É–µ–º –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º - CNAME 4-–π –≤ —Å–ø–∏—Å–∫–µ
                const dropdown = await page.$("[class*=\"dropdown\"], [class*=\"select-menu\"], [class*=\"options\"]");
                if (dropdown) {
                  const options = await dropdown.$$("div, li");
                  console.log("–ù–∞–π–¥–µ–Ω–æ options:", options.length);
                  // CNAME –æ–±—ã—á–Ω–æ 4-–π (A, AAAA, MX, CNAME)
                  if (options.length >= 4) {
                    await options[3].click();
                    console.log("‚úÖ –ö–ª–∏–∫–Ω—É–ª –Ω–∞ 4-–π —ç–ª–µ–º–µ–Ω—Ç");
                  }
                }
              }
              
              await page.waitForTimeout(1500);
              await page.screenshot({ path: "after_cname.png", fullPage: true });
              
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ CNAME –≤—ã–±—Ä–∞–Ω
              const typeText = await page.$eval("[class*=\"select\"]", el => el.textContent).catch(() => "");
              console.log("–¢–µ–∫—É—â–∏–π —Ç–∏–ø:", typeText);
              
              // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
              console.log("‚úèÔ∏è –ó–∞–ø–æ–ª–Ω—è—é –•–æ—Å—Ç: portal");
              
              const inputs = await page.$$("div[class*=\"modal\"] input, [role=\"dialog\"] input");
              console.log("–ù–∞–π–¥–µ–Ω–æ inputs –≤ –º–æ–¥–∞–ª–µ:", inputs.length);
              
              // –ü–µ—Ä–≤—ã–π input - —Ö–æ—Å—Ç
              if (inputs.length > 0) {
                await inputs[0].fill("portal");
              }
              
              // –í—Ç–æ—Ä–æ–π input - –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è CNAME —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "–ó–Ω–∞—á–µ–Ω–∏–µ")
              if (inputs.length > 1) {
                await inputs[1].fill("cname.vercel-dns.com");
              }
              
              await page.screenshot({ path: "form_filled.png", fullPage: true });
              
              console.log("üíæ –°–æ—Ö—Ä–∞–Ω—è—é...");
              await page.click("button:has-text(\"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å\")");
              await page.waitForTimeout(3000);
              
              await page.screenshot({ path: "result.png", fullPage: true });
              console.log("‚úÖ –ì–æ—Ç–æ–≤–æ!");
              
            } catch (e) {
              console.log("‚ùå –û—à–∏–±–∫–∞:", e.message);
              await page.screenshot({ path: "error.png", fullPage: true });
            }
            
            await browser.close();
          })();
          EOF
          
          node add_dns.js
          
      - name: Upload screenshots
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: dns-screenshots
          path: "*.png"

