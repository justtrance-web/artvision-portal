name: Add DNS Record v4

on:
  workflow_dispatch:

jobs:
  add-dns:
    runs-on: ubuntu-latest
    steps:
      - name: Install Playwright
        run: |
          npm init -y
          npm install playwright
          npx playwright install chromium

      - name: Add CNAME portal.artvision.pro
        run: |
          cat > add_dns.js << 'EOF'
          const { chromium } = require("playwright");

          (async () => {
            const browser = await chromium.launch({ headless: true });
            const page = await browser.newPage();
            
            try {
              console.log("üîê –õ–æ–≥–∏–Ω...");
              await page.goto("https://hosting.timeweb.ru/login");
              await page.waitForTimeout(3000);
              await page.fill("input[type=\"text\"]", "cp02586");
              await page.fill("input[type=\"password\"]", "6CNgRdxX222");
              await page.click("button[type=\"submit\"]");
              await page.waitForTimeout(5000);
              
              console.log("üåê DNS —Ä–µ–¥–∞–∫—Ç–æ—Ä...");
              await page.goto("https://hosting.timeweb.ru/domains/settings/dns-editor?fqdn=artvision.pro");
              await page.waitForTimeout(4000);
              
              // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø—ã
              const closeButtons = await page.$$("button:has-text(\"–ó–∞–∫—Ä—ã—Ç—å\"), button:has-text(\"–ü–æ–Ω—è—Ç–Ω–æ\")");
              for (const btn of closeButtons) { await btn.click().catch(() => {}); }
              await page.waitForTimeout(500);
              
              console.log("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å...");
              await page.click("text=–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å");
              await page.waitForTimeout(2000);
              
              // –ö–ª–∏–∫–∞–µ–º –Ω–∞ dropdown —Å —Ç–∏–ø–æ–º (–≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ "A")
              console.log("üìù –û—Ç–∫—Ä—ã–≤–∞—é dropdown —Ç–∏–ø–∞...");
              
              // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∞—â–∏–π "A" —Ä—è–¥–æ–º —Å "–¢–∏–ø"
              await page.click("div.select, [class*=\"select\"] >> text=A");
              await page.waitForTimeout(1000);
              await page.screenshot({ path: "dropdown_opened.png", fullPage: true });
              
              // –í—ã–±–∏—Ä–∞–µ–º CNAME –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è —Å–ø–∏—Å–∫–µ
              console.log("üìù –í—ã–±–∏—Ä–∞—é CNAME...");
              await page.click("text=CNAME");
              await page.waitForTimeout(1000);
              await page.screenshot({ path: "cname_selected.png", fullPage: true });
              
              // –¢–µ–ø–µ—Ä—å –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
              console.log("‚úèÔ∏è –ó–∞–ø–æ–ª–Ω—è—é –•–æ—Å—Ç: portal");
              
              // –ò—â–µ–º –≤—Å–µ input –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
              const modal = await page.$("div[class*=\"modal\"], div[role=\"dialog\"], .modal");
              const inputs = modal ? await modal.$$("input") : await page.$$("input");
              console.log("–ù–∞–π–¥–µ–Ω–æ inputs:", inputs.length);
              
              for (let i = 0; i < inputs.length; i++) {
                const placeholder = await inputs[i].getAttribute("placeholder");
                const value = await inputs[i].inputValue();
                console.log(`  Input ${i}: placeholder="${placeholder}", value="${value}"`);
              }
              
              // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ –•–æ—Å—Ç (–ø—É—Å—Ç–æ–π input)
              for (const input of inputs) {
                const val = await input.inputValue();
                if (val === "") {
                  await input.fill("portal");
                  break;
                }
              }
              
              await page.waitForTimeout(500);
              
              // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è CNAME
              const allInputs = await page.$$("input");
              for (const input of allInputs) {
                const val = await input.inputValue();
                const placeholder = await input.getAttribute("placeholder") || "";
                if (val === "" && !placeholder.includes("–•–æ—Å—Ç")) {
                  await input.fill("cname.vercel-dns.com");
                  break;
                }
              }
              
              await page.screenshot({ path: "form_filled.png", fullPage: true });
              
              console.log("üíæ –°–æ—Ö—Ä–∞–Ω—è—é...");
              await page.click("button:has-text(\"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å\")");
              await page.waitForTimeout(3000);
              
              await page.screenshot({ path: "result.png", fullPage: true });
              console.log("‚úÖ –ì–æ—Ç–æ–≤–æ!");
              
            } catch (e) {
              console.log("‚ùå –û—à–∏–±–∫–∞:", e.message);
              await page.screenshot({ path: "error.png", fullPage: true });
            }
            
            await browser.close();
          })();
          EOF
          
          node add_dns.js
          
      - name: Upload screenshots
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: dns-screenshots
          path: "*.png"

